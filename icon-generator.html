<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Icon Generator - ChatGPT Quick Access</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #10a37f;
            text-align: center;
            margin-bottom: 30px;
        }
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .icon-item {
            text-align: center;
            padding: 20px;
            border: 2px solid #eee;
            border-radius: 8px;
            background: #fafafa;
        }
        .icon-item h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
                 .icon-display {
             border: 1px solid #ddd;
             border-radius: 4px;
             background: white;
             margin: 10px 0;
             display: inline-block;
             cursor: pointer;
             transition: transform 0.2s ease;
         }
         
         .icon-display:hover {
             transform: scale(1.1);
             box-shadow: 0 4px 12px rgba(0,0,0,0.15);
         }
         
         .icon-display.zoomed {
             transform: scale(3);
             z-index: 1000;
             position: relative;
             box-shadow: 0 8px 25px rgba(0,0,0,0.3);
         }
        .download-btn {
            background: #10a37f;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .download-btn:hover {
            background: #0d8b6a;
        }
        .instructions {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .instructions h2 {
            color: #10a37f;
            margin-top: 0;
        }
        .instructions ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        .instructions li {
            margin-bottom: 8px;
        }
                 canvas {
             display: block;
             margin: 0 auto;
         }
         
         .upload-section {
             background: #f0f8ff;
             padding: 20px;
             border-radius: 8px;
             margin-bottom: 20px;
             border: 2px dashed #10a37f;
         }
         
         .upload-section h2 {
             color: #10a37f;
             margin-top: 0;
             margin-bottom: 15px;
         }
         
         .upload-area {
             text-align: center;
             margin-bottom: 15px;
         }
         
         .upload-btn {
             background: #10a37f;
             color: white;
             border: none;
             padding: 12px 24px;
             border-radius: 6px;
             cursor: pointer;
             font-size: 14px;
             font-weight: 500;
             transition: all 0.3s ease;
         }
         
         .upload-btn:hover {
             background: #0d8b6a;
             transform: translateY(-1px);
         }
         
         .upload-hint {
             font-size: 12px;
             color: #666;
             margin-top: 8px;
         }
         
         .preview-original {
             text-align: center;
             padding: 15px;
             background: white;
             border-radius: 6px;
             margin-top: 15px;
         }
         
         .preview-original h3 {
             color: #333;
             margin-bottom: 10px;
             font-size: 14px;
         }
         
         /* Modal para zoom */
         .modal {
             display: none;
             position: fixed;
             z-index: 2000;
             left: 0;
             top: 0;
             width: 100%;
             height: 100%;
             background-color: rgba(0,0,0,0.8);
             backdrop-filter: blur(5px);
         }
         
         .modal-content {
             background-color: white;
             margin: 5% auto;
             padding: 30px;
             border-radius: 12px;
             width: 90%;
             max-width: 500px;
             text-align: center;
             position: relative;
             animation: modalSlideIn 0.3s ease;
         }
         
         @keyframes modalSlideIn {
             from { transform: translateY(-50px); opacity: 0; }
             to { transform: translateY(0); opacity: 1; }
         }
         
         .modal-close {
             position: absolute;
             top: 15px;
             right: 20px;
             font-size: 24px;
             font-weight: bold;
             color: #aaa;
             cursor: pointer;
             transition: color 0.3s ease;
         }
         
         .modal-close:hover {
             color: #333;
         }
         
                   .modal-icon {
              margin: 20px 0;
              border: 2px solid #eee;
              border-radius: 8px;
              background: white;
              display: inline-block;
              max-width: 100%;
              overflow: auto;
          }
          
          .modal-icon canvas {
              max-width: 100%;
              height: auto;
              display: block;
          }
         
         .modal-info {
             margin-top: 20px;
             padding: 15px;
             background: #f8f9fa;
             border-radius: 8px;
         }
         
         .modal-info h3 {
             color: #10a37f;
             margin-bottom: 10px;
         }
         
         .modal-info p {
             color: #666;
             margin: 5px 0;
             font-size: 14px;
         }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Icon Generator - ChatGPT Quick Access</h1>
        
                 <div class="instructions">
             <h2>üìã Instrucciones:</h2>
             <ol>
                 <li><strong>Sube tu imagen:</strong> Usa el bot√≥n "Seleccionar Imagen" para cargar tu icono de robot</li>
                 <li><strong>Vista previa:</strong> Ve c√≥mo se ve en todos los tama√±os en tiempo real</li>
                 <li><strong>Zoom en iconos:</strong> Haz clic en cualquier icono para verlo ampliado</li>
                 <li><strong>Descarga los iconos:</strong> Usa los botones de descarga para cada tama√±o</li>
                 <li><strong>Coloca en la carpeta:</strong> Mueve los archivos descargados a la carpeta <code>icons/</code></li>
             </ol>
         </div>

        <div class="upload-section">
            <h2>üé® Subir tu Imagen</h2>
            <div class="upload-area">
                <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                <button onclick="document.getElementById('imageUpload').click()" class="upload-btn">
                    üìÅ Seleccionar Imagen
                </button>
                <p class="upload-hint">Formatos: PNG, JPG, SVG (recomendado: 128x128 o m√°s grande)</p>
            </div>
            <div class="preview-original" style="display: none;">
                <h3>Tu imagen original:</h3>
                <img id="originalImage" alt="Imagen original" style="max-width: 128px; max-height: 128px; border: 2px solid #ddd; border-radius: 8px;">
            </div>
        </div>

        <div class="icon-grid">
                         <div class="icon-item">
                 <h3>16x16 (Toolbar)</h3>
                 <div class="icon-display" onclick="openModal(16)">
                     <canvas id="canvas16" width="16" height="16"></canvas>
                 </div>
                 <button class="download-btn" onclick="downloadIcon(16)">Download icon16.png</button>
             </div>
            
                         <div class="icon-item">
                 <h3>32x32 (Windows)</h3>
                 <div class="icon-display" onclick="openModal(32)">
                     <canvas id="canvas32" width="32" height="32"></canvas>
                 </div>
                 <button class="download-btn" onclick="downloadIcon(32)">Download icon32.png</button>
             </div>
            
                         <div class="icon-item">
                 <h3>48x48 (Extension Page)</h3>
                 <div class="icon-display" onclick="openModal(48)">
                     <canvas id="canvas48" width="48" height="48"></canvas>
                 </div>
                 <button class="download-btn" onclick="downloadIcon(48)">Download icon48.png</button>
             </div>
            
                         <div class="icon-item">
                 <h3>128x128 (Chrome Web Store)</h3>
                 <div class="icon-display" onclick="openModal(128)">
                     <canvas id="canvas128" width="128" height="128"></canvas>
                 </div>
                 <button class="download-btn" onclick="downloadIcon(128)">Download icon128.png</button>
             </div>
        </div>

                 <div style="text-align: center; margin-top: 30px;">
             <button onclick="generateAllIcons()" style="background: #10a37f; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 16px; cursor: pointer; margin-right: 10px;">
                 üé® Regenerar Iconos
             </button>
             <button onclick="resetToDefault()" style="background: #6c757d; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 16px; cursor: pointer;">
                 üîÑ Usar Icono por Defecto
             </button>
         </div>

                 <div style="margin-top: 30px; text-align: center;">
             <h3>üìÅ Despu√©s de descargar:</h3>
             <p>Mueve todos los archivos <code>icon*.png</code> a la carpeta <code>icons/</code> del proyecto</p>
         </div>
     </div>

     <!-- Modal para zoom -->
     <div id="zoomModal" class="modal">
         <div class="modal-content">
             <span class="modal-close" onclick="closeModal()">&times;</span>
             <h2>üîç Vista Ampliada del Icono</h2>
                           <div class="modal-icon">
                  <canvas id="modalCanvas" width="512" height="512"></canvas>
              </div>
             <div class="modal-info">
                 <h3 id="modalTitle">Icono 16x16</h3>
                 <p id="modalSize">Tama√±o: 16x16 p√≠xeles</p>
                 <p id="modalUse">Uso: Toolbar del navegador</p>
                 <p id="modalQuality">Calidad: Alta resoluci√≥n</p>
             </div>
                           <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                  <button onclick="adjustZoom(-1)" class="download-btn" style="padding: 8px 16px; font-size: 12px;">
                      üîç Zoom -
                  </button>
                  <button onclick="adjustZoom(1)" class="download-btn" style="padding: 8px 16px; font-size: 12px;">
                      üîç Zoom +
                  </button>
                  <button onclick="adjustZoomFine(-1)" class="download-btn" style="padding: 8px 16px; font-size: 12px; background: #17a2b8;">
                      üî¨ Fino -
                  </button>
                  <button onclick="adjustZoomFine(1)" class="download-btn" style="padding: 8px 16px; font-size: 12px; background: #17a2b8;">
                      üî¨ Fino +
                  </button>
                                     <button onclick="toggleGrid()" class="download-btn" style="padding: 8px 16px; font-size: 12px; background: #6c757d;">
                       üìê Grid
                   </button>
               </div>
               <div style="margin-top: 10px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                   <button onclick="moveImage(-20, 0)" class="download-btn" style="padding: 8px 16px; font-size: 12px; background: #dc3545;">
                       ‚¨ÖÔ∏è Izq
                   </button>
                   <button onclick="moveImage(20, 0)" class="download-btn" style="padding: 8px 16px; font-size: 12px; background: #dc3545;">
                       ‚û°Ô∏è Der
                   </button>
                   <button onclick="moveImage(0, -20)" class="download-btn" style="padding: 8px 16px; font-size: 12px; background: #dc3545;">
                       ‚¨ÜÔ∏è Arriba
                   </button>
                   <button onclick="moveImage(0, 20)" class="download-btn" style="padding: 8px 16px; font-size: 12px; background: #dc3545;">
                       ‚¨áÔ∏è Abajo
                   </button>
                   <button onclick="centerImage()" class="download-btn" style="padding: 8px 16px; font-size: 12px; background: #28a745;">
                       üéØ Centrar
                   </button>
              </div>
                                                                          <div style="margin-top: 10px; text-align: center; font-size: 12px; color: #666;">
                   Zoom actual: <span id="zoomLevel">1.0</span>x | 
                   Posici√≥n: <span id="imagePosition">Centrada</span>
               </div>
               <div style="margin-top: 5px; text-align: center; font-size: 10px; color: #999;">
                   <button onclick="console.log('Debug zoom:', { currentZoom, currentModalSize, finalSize: Math.round(currentModalSize * currentZoom) })" style="background: #ffc107; color: #333; border: none; padding: 4px 8px; border-radius: 4px; font-size: 10px; cursor: pointer;">
                       üêõ Debug Zoom
                   </button>
               </div>
                             <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                                                                                                                                                                                  <button onclick="downloadFromModal()" class="download-btn" style="padding: 12px 24px; font-size: 14px;">
                       üíæ Descargar (crop con posici√≥n actual)
                   </button>
                   <button onclick="downloadIcon(currentModalSize); closeModal();" class="download-btn" style="padding: 12px 24px; font-size: 14px; background: #6c757d;">
                       üìÑ Descargar Original
                   </button>
               </div>
         </div>
     </div>

         <script>
         let uploadedImage = null;
         
         // Funci√≥n para dibujar el icono de robot (fallback)
         function drawRobotIcon(canvas, size) {
             const ctx = canvas.getContext('2d');
             const scale = size / 128; // Escala basada en el tama√±o original de 128x128
             
             // Limpiar canvas
             ctx.clearRect(0, 0, size, size);
             
             // Si hay una imagen subida, usarla
             if (uploadedImage) {
                 drawUploadedImage(canvas, size);
                 return;
             }
             
             // Colores del robot (fallback)
             const lightGreen = '#4ade80';
             const darkGreen = '#16a34a';
             const shadowGreen = '#15803d';
             
             // Cabeza del robot (rect√°ngulo redondeado)
             const headWidth = 80 * scale;
             const headHeight = 60 * scale;
             const headX = (size - headWidth) / 2;
             const headY = (size - headHeight) / 2 - 5 * scale;
             
             // Dibujar cabeza con sombra
             ctx.fillStyle = shadowGreen;
             ctx.fillRect(headX + 2 * scale, headY + 2 * scale, headWidth, headHeight);
             
             // Cabeza principal
             ctx.fillStyle = lightGreen;
             ctx.fillRect(headX, headY, headWidth, headHeight);
             
             // Bordes de la cabeza
             ctx.strokeStyle = darkGreen;
             ctx.lineWidth = 2 * scale;
             ctx.strokeRect(headX, headY, headWidth, headHeight);
             
             // Ojos
             const eyeSize = 12 * scale;
             const eyeY = headY + 15 * scale;
             const leftEyeX = headX + 20 * scale;
             const rightEyeX = headX + headWidth - 20 * scale - eyeSize;
             
             ctx.fillStyle = darkGreen;
             ctx.fillRect(leftEyeX, eyeY, eyeSize, eyeSize);
             ctx.fillRect(rightEyeX, eyeY, eyeSize, eyeSize);
             
             // Boca/Ventilaci√≥n
             const mouthWidth = 30 * scale;
             const mouthHeight = 8 * scale;
             const mouthX = headX + (headWidth - mouthWidth) / 2;
             const mouthY = headY + headHeight - 20 * scale;
             
             ctx.fillStyle = darkGreen;
             ctx.fillRect(mouthX, mouthY, mouthWidth, mouthHeight);
             
             // Orejas/Antenas laterales
             const earWidth = 8 * scale;
             const earHeight = 20 * scale;
             const leftEarX = headX - earWidth;
             const rightEarX = headX + headWidth;
             const earY = headY + 10 * scale;
             
             ctx.fillStyle = darkGreen;
             ctx.fillRect(leftEarX, earY, earWidth, earHeight);
             ctx.fillRect(rightEarX, earY, earWidth, earHeight);
             
             // Antena superior
             const antennaWidth = 3 * scale;
             const antennaHeight = 15 * scale;
             const antennaX = headX + (headWidth - antennaWidth) / 2;
             const antennaY = headY - antennaHeight;
             
             ctx.fillStyle = darkGreen;
             ctx.fillRect(antennaX, antennaY, antennaWidth, antennaHeight);
             
             // C√≠rculo de la antena
             const antennaCircleSize = 6 * scale;
             const antennaCircleX = antennaX - (antennaCircleSize - antennaWidth) / 2;
             const antennaCircleY = antennaY - antennaCircleSize;
             
             ctx.fillStyle = darkGreen;
             ctx.fillRect(antennaCircleX, antennaCircleY, antennaCircleSize, antennaCircleSize);
         }
         
                   // Funci√≥n para dibujar la imagen subida
          function drawUploadedImage(canvas, size) {
              const ctx = canvas.getContext('2d');
              
              // Limpiar canvas
              ctx.clearRect(0, 0, size, size);
              
              // Calcular dimensiones para mantener proporci√≥n
              const imgAspectRatio = uploadedImage.width / uploadedImage.height;
              const canvasAspectRatio = size / size;
              
              let drawWidth, drawHeight, offsetX, offsetY;
              
              if (imgAspectRatio > canvasAspectRatio) {
                  // Imagen m√°s ancha que alta
                  drawWidth = size;
                  drawHeight = size / imgAspectRatio;
                  offsetX = 0;
                  offsetY = (size - drawHeight) / 2;
              } else {
                  // Imagen m√°s alta que ancha
                  drawWidth = size * imgAspectRatio;
                  drawHeight = size;
                  offsetX = (size - drawWidth) / 2;
                  offsetY = 0;
              }
              
              // Dibujar la imagen centrada con mejor calidad
              ctx.imageSmoothingEnabled = true;
              ctx.imageSmoothingQuality = 'high';
              ctx.drawImage(uploadedImage, offsetX, offsetY, drawWidth, drawHeight);
          }
          
          // Funci√≥n para dibujar grid de p√≠xeles
          function drawPixelGrid(ctx, canvasSize, canvasSize, scale) {
              ctx.strokeStyle = 'rgba(255, 0, 0, 0.3)';
              ctx.lineWidth = 1;
              
              // Dibujar l√≠neas verticales
              for (let x = 0; x <= canvasSize; x += scale) {
                  ctx.beginPath();
                  ctx.moveTo(x, 0);
                  ctx.lineTo(x, canvasSize);
                  ctx.stroke();
              }
              
              // Dibujar l√≠neas horizontales
              for (let y = 0; y <= canvasSize; y += scale) {
                  ctx.beginPath();
                  ctx.moveTo(0, y);
                  ctx.lineTo(canvasSize, y);
                  ctx.stroke();
              }
          }
        
        // Generar todos los iconos
        function generateAllIcons() {
            const sizes = [16, 32, 48, 128];
            sizes.forEach(size => {
                const canvas = document.getElementById(`canvas${size}`);
                drawRobotIcon(canvas, size);
            });
        }
        
                           // Descargar icono
          function downloadIcon(size) {
              const canvas = document.getElementById(`canvas${size}`);
              const link = document.createElement('a');
              link.download = `icon${size}.png`;
              link.href = canvas.toDataURL();
              link.click();
          }
          
                                                     // Descargar icono con zoom aplicado (crop del √°rea visible)
          function downloadIconWithZoom(size) {
              console.log('Descargando con crop/zoom:', { size, currentZoom, imageOffsetX, imageOffsetY });
              
              // Crear un canvas temporal del tama√±o original
              const tempCanvas = document.createElement('canvas');
              const ctx = tempCanvas.getContext('2d');
              tempCanvas.width = size;
              tempCanvas.height = size;
              
              // Calcular el √°rea visible en el modal (512x512)
              const modalSize = 512;
              const baseScale = modalSize / Math.max(uploadedImage ? uploadedImage.width : 128, uploadedImage ? uploadedImage.height : 128);
              const baseDrawWidth = (uploadedImage ? uploadedImage.width : 128) * baseScale;
              const baseDrawHeight = (uploadedImage ? uploadedImage.height : 128) * baseScale;
              const baseOffsetX = (modalSize - baseDrawWidth) / 2;
              const baseOffsetY = (modalSize - baseDrawHeight) / 2;
              
              // Calcular el √°rea visible con zoom y posici√≥n ajustada
              const zoomedDrawWidth = baseDrawWidth * currentZoom;
              const zoomedDrawHeight = baseDrawHeight * currentZoom;
              const zoomedOffsetX = (modalSize - zoomedDrawWidth) / 2 + imageOffsetX;
              const zoomedOffsetY = (modalSize - zoomedDrawHeight) / 2 + imageOffsetY;
              
              // Calcular el √°rea visible (crop centrado)
              let visibleX, visibleY, visibleWidth, visibleHeight;
              
              if (currentZoom > 1) {
                  // Zoom in: recortar desde el centro
                  const centerX = modalSize / 2;
                  const centerY = modalSize / 2;
                  const cropSize = modalSize / currentZoom;
                  
                  visibleX = centerX - cropSize / 2;
                  visibleY = centerY - cropSize / 2;
                  visibleWidth = cropSize;
                  visibleHeight = cropSize;
              } else {
                  // Zoom out: mostrar todo el √°rea visible
                  visibleX = Math.max(0, -zoomedOffsetX);
                  visibleY = Math.max(0, -zoomedOffsetY);
                  visibleWidth = Math.min(modalSize, zoomedDrawWidth + zoomedOffsetX) - visibleX;
                  visibleHeight = Math.min(modalSize, zoomedDrawHeight + zoomedOffsetY) - visibleY;
              }
              
              // Crear un canvas temporal para el modal
              const modalCanvas = document.createElement('canvas');
              modalCanvas.width = modalSize;
              modalCanvas.height = modalSize;
              const modalCtx = modalCanvas.getContext('2d');
              
              // Dibujar en el modal temporal con posici√≥n ajustada
              if (uploadedImage) {
                  modalCtx.imageSmoothingEnabled = true;
                  modalCtx.imageSmoothingQuality = 'high';
                  modalCtx.drawImage(uploadedImage, zoomedOffsetX, zoomedOffsetY, zoomedDrawWidth, zoomedDrawHeight);
              } else {
                  // Usar icono por defecto
                  const tempIconCanvas = document.createElement('canvas');
                  tempIconCanvas.width = zoomedDrawWidth;
                  tempIconCanvas.height = zoomedDrawHeight;
                  drawRobotIcon(tempIconCanvas, Math.max(zoomedDrawWidth, zoomedDrawHeight));
                  modalCtx.drawImage(tempIconCanvas, zoomedOffsetX, zoomedOffsetY);
              }
              
              // Hacer crop del √°rea visible y escalar al tama√±o final
              ctx.imageSmoothingEnabled = true;
              ctx.imageSmoothingQuality = 'high';
              ctx.drawImage(modalCanvas, visibleX, visibleY, visibleWidth, visibleHeight, 0, 0, size, size);
              
              // Descargar
              const link = document.createElement('a');
              const filename = `icon${size}.png`; // Mantener nombre original para build
              link.download = filename;
              link.href = tempCanvas.toDataURL();
              console.log('Descargando archivo:', filename, 'Tama√±o:', size + 'x' + size, 'Crop con zoom:', currentZoom.toFixed(2) + 'x', 'Posici√≥n:', imageOffsetX + ',' + imageOffsetY);
              link.click();
          }
         
         // Resetear al icono por defecto
         function resetToDefault() {
             uploadedImage = null;
             document.querySelector('.preview-original').style.display = 'none';
             generateAllIcons();
             showMessage('üîÑ Cambiado al icono por defecto', 'info');
         }
         
                   // Variables para el modal
          let currentModalSize = 16;
          let currentZoom = 1;
          let showGrid = true;
          let imageOffsetX = 0;
          let imageOffsetY = 0;
         
         // Abrir modal con zoom
         function openModal(size) {
             currentModalSize = size;
             const modal = document.getElementById('zoomModal');
             const modalCanvas = document.getElementById('modalCanvas');
             const modalTitle = document.getElementById('modalTitle');
             const modalSize = document.getElementById('modalSize');
             const modalUse = document.getElementById('modalUse');
             const modalQuality = document.getElementById('modalQuality');
             
             // Dibujar el icono en el modal (512x512 para mejor vista)
             const ctx = modalCanvas.getContext('2d');
             ctx.clearRect(0, 0, 512, 512);
             
             if (uploadedImage) {
                 // Usar imagen subida - mostrar en tama√±o real y ampliado
                 const scale = 512 / Math.max(uploadedImage.width, uploadedImage.height);
                 const drawWidth = uploadedImage.width * scale;
                 const drawHeight = uploadedImage.height * scale;
                 const offsetX = (512 - drawWidth) / 2;
                 const offsetY = (512 - drawHeight) / 2;
                 
                 // Dibujar con mejor calidad
                 ctx.imageSmoothingEnabled = true;
                 ctx.imageSmoothingQuality = 'high';
                 ctx.drawImage(uploadedImage, offsetX, offsetY, drawWidth, drawHeight);
                 
                 // Agregar grid para ver p√≠xeles
                 drawPixelGrid(ctx, 512, 512, scale);
             } else {
                 // Usar icono por defecto
                 drawRobotIcon(modalCanvas, 512);
                 
                 // Agregar grid para ver p√≠xeles
                 const scale = 512 / 128; // Escala del icono por defecto
                 drawPixelGrid(ctx, 512, 512, scale);
             }
             
             // Actualizar informaci√≥n del modal
             const sizeInfo = {
                 16: { title: 'Icono 16x16', use: 'Toolbar del navegador', quality: 'Alta resoluci√≥n' },
                 32: { title: 'Icono 32x32', use: 'Windows y aplicaciones', quality: 'Alta resoluci√≥n' },
                 48: { title: 'Icono 48x48', use: 'P√°gina de extensiones', quality: 'Alta resoluci√≥n' },
                 128: { title: 'Icono 128x128', use: 'Chrome Web Store', quality: 'M√°xima resoluci√≥n' }
             };
             
             modalTitle.textContent = sizeInfo[size].title;
             modalSize.textContent = `Tama√±o: ${size}x${size} p√≠xeles`;
             modalUse.textContent = `Uso: ${sizeInfo[size].use}`;
             modalQuality.textContent = `Calidad: ${sizeInfo[size].quality}`;
             
                           // Resetear zoom y posici√≥n
              currentZoom = 1;
              imageOffsetX = 0;
              imageOffsetY = 0;
              showGrid = true;
             
             // Mostrar modal
             modal.style.display = 'block';
             
             // Prevenir scroll del body
             document.body.style.overflow = 'hidden';
             
             // Actualizar indicador de zoom
             updateZoomLevel();
             
             // Redibujar con zoom inicial
             redrawModal();
         }
         
         // Cerrar modal
         function closeModal() {
             const modal = document.getElementById('zoomModal');
             modal.style.display = 'none';
             document.body.style.overflow = 'auto';
         }
         
                                                                                                                                     // Descargar desde el modal
          function downloadFromModal() {
              downloadIconWithZoom(currentModalSize);
              const positionText = imageOffsetX === 0 && imageOffsetY === 0 ? 'centrado' : `posici√≥n X:${imageOffsetX} Y:${imageOffsetY}`;
              showMessage(`‚úÖ Descargado icon${currentModalSize}.png con crop ${positionText} (zoom ${currentZoom.toFixed(2)}x)`, 'success');
              closeModal();
          }
         
         // Cerrar modal al hacer clic fuera
         window.onclick = function(event) {
             const modal = document.getElementById('zoomModal');
             if (event.target === modal) {
                 closeModal();
             }
         }
         
                   // Cerrar modal con ESC
          document.addEventListener('keydown', function(event) {
              if (event.key === 'Escape') {
                  closeModal();
              } else if (event.key === '+' || event.key === '=') {
                  event.preventDefault();
                  adjustZoom(1);
              } else if (event.key === '-') {
                  event.preventDefault();
                  adjustZoom(-1);
              } else if (event.key === 'ArrowUp') {
                  event.preventDefault();
                  if (event.shiftKey) {
                      moveImage(0, -20);
                  } else {
                      adjustZoomFine(1);
                  }
              } else if (event.key === 'ArrowDown') {
                  event.preventDefault();
                  if (event.shiftKey) {
                      moveImage(0, 20);
                  } else {
                      adjustZoomFine(-1);
                  }
              } else if (event.key === 'ArrowLeft') {
                  event.preventDefault();
                  moveImage(-20, 0);
              } else if (event.key === 'ArrowRight') {
                  event.preventDefault();
                  moveImage(20, 0);
              } else if (event.key === 'c' || event.key === 'C') {
                  event.preventDefault();
                  centerImage();
              }
          });
          
          // Ajustar zoom
          function adjustZoom(direction) {
              currentZoom = Math.max(0.5, Math.min(4, currentZoom + direction * 0.1));
              updateZoomLevel();
              redrawModal();
          }
          
          // Ajustar zoom fino
          function adjustZoomFine(direction) {
              currentZoom = Math.max(0.5, Math.min(4, currentZoom + direction * 0.02));
              updateZoomLevel();
              redrawModal();
          }
          
                               // Actualizar indicador de zoom
          function updateZoomLevel() {
              const zoomLevelElement = document.getElementById('zoomLevel');
              
              if (zoomLevelElement) {
                  zoomLevelElement.textContent = currentZoom.toFixed(2);
              }
              
              updateImagePosition();
          }
          
          // Alternar grid
          function toggleGrid() {
              showGrid = !showGrid;
              redrawModal();
          }
          
          // Mover imagen
          function moveImage(deltaX, deltaY) {
              imageOffsetX += deltaX;
              imageOffsetY += deltaY;
              updateImagePosition();
              redrawModal();
          }
          
          // Centrar imagen
          function centerImage() {
              imageOffsetX = 0;
              imageOffsetY = 0;
              updateImagePosition();
              redrawModal();
          }
          
          // Actualizar indicador de posici√≥n
          function updateImagePosition() {
              const positionElement = document.getElementById('imagePosition');
              if (positionElement) {
                  if (imageOffsetX === 0 && imageOffsetY === 0) {
                      positionElement.textContent = 'Centrada';
                  } else {
                      positionElement.textContent = `X:${imageOffsetX} Y:${imageOffsetY}`;
                  }
              }
          }
          
          // Redibujar modal con zoom actual
          function redrawModal() {
              const modalCanvas = document.getElementById('modalCanvas');
              const ctx = modalCanvas.getContext('2d');
              
              // Limpiar canvas
              ctx.clearRect(0, 0, 512, 512);
              
              if (uploadedImage) {
                  // Usar imagen subida con zoom y posici√≥n ajustada
                  const baseScale = 512 / Math.max(uploadedImage.width, uploadedImage.height);
                  const scale = baseScale * currentZoom;
                  const drawWidth = uploadedImage.width * scale;
                  const drawHeight = uploadedImage.height * scale;
                  const offsetX = (512 - drawWidth) / 2 + imageOffsetX;
                  const offsetY = (512 - drawHeight) / 2 + imageOffsetY;
                  
                  // Dibujar con mejor calidad
                  ctx.imageSmoothingEnabled = true;
                  ctx.imageSmoothingQuality = 'high';
                  ctx.drawImage(uploadedImage, offsetX, offsetY, drawWidth, drawHeight);
                  
                  // Agregar grid si est√° habilitado
                  if (showGrid) {
                      drawPixelGrid(ctx, 512, 512, scale);
                  }
              } else {
                  // Usar icono por defecto con zoom y posici√≥n ajustada
                  const baseScale = 512 / 128;
                  const scale = baseScale * currentZoom;
                  
                  // Redibujar el icono con el zoom aplicado
                  const tempCanvas = document.createElement('canvas');
                  tempCanvas.width = 128 * currentZoom;
                  tempCanvas.height = 128 * currentZoom;
                  drawRobotIcon(tempCanvas, 128 * currentZoom);
                  
                  const offsetX = (512 - tempCanvas.width) / 2 + imageOffsetX;
                  const offsetY = (512 - tempCanvas.height) / 2 + imageOffsetY;
                  ctx.drawImage(tempCanvas, offsetX, offsetY);
                  
                  // Agregar grid si est√° habilitado
                  if (showGrid) {
                      drawPixelGrid(ctx, 512, 512, scale);
                  }
              }
          }
        
                 // Manejar la carga de archivos
         document.getElementById('imageUpload').addEventListener('change', function(event) {
             const file = event.target.files[0];
             if (file) {
                 const reader = new FileReader();
                 reader.onload = function(e) {
                     const img = new Image();
                     img.onload = function() {
                         uploadedImage = img;
                         
                         // Mostrar vista previa de la imagen original
                         document.getElementById('originalImage').src = e.target.result;
                         document.querySelector('.preview-original').style.display = 'block';
                         
                         // Regenerar todos los iconos con la nueva imagen
                         generateAllIcons();
                         
                         // Mostrar mensaje de √©xito
                         showMessage('‚úÖ Imagen cargada exitosamente. Ve la vista previa en todos los tama√±os.', 'success');
                     };
                     img.src = e.target.result;
                 };
                 reader.readAsDataURL(file);
             }
         });
         
         // Funci√≥n para mostrar mensajes
         function showMessage(text, type = 'info') {
             // Crear elemento de mensaje
             const messageDiv = document.createElement('div');
             messageDiv.style.cssText = `
                 position: fixed;
                 top: 20px;
                 right: 20px;
                 padding: 12px 20px;
                 border-radius: 6px;
                 color: white;
                 font-weight: 500;
                 z-index: 1000;
                 animation: slideIn 0.3s ease;
                 background: ${type === 'success' ? '#10a37f' : '#ff6b6b'};
             `;
             messageDiv.textContent = text;
             
             // Agregar estilos de animaci√≥n
             const style = document.createElement('style');
             style.textContent = `
                 @keyframes slideIn {
                     from { transform: translateX(100%); opacity: 0; }
                     to { transform: translateX(0); opacity: 1; }
                 }
             `;
             document.head.appendChild(style);
             
             document.body.appendChild(messageDiv);
             
             // Remover mensaje despu√©s de 3 segundos
             setTimeout(() => {
                 messageDiv.style.animation = 'slideOut 0.3s ease';
                 setTimeout(() => {
                     document.body.removeChild(messageDiv);
                 }, 300);
             }, 3000);
         }
         
         // Generar iconos al cargar la p√°gina
         window.onload = function() {
             generateAllIcons();
         };
    </script>
</body>
</html>
